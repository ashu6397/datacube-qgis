dist: trusty
sudo: true  # Use the new travis docker based infrastructure

git:
  # We need a deeper depth for 'git descibe' to ensure
  # we can reach the last tagged version.
  depth: 99999

language: python
python:
  - "3.6"

install:
  - wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
  - bash miniconda.sh -b -p $HOME/miniconda
  - export PATH="$HOME/miniconda/bin:$PATH"
  - hash -r
  - conda config --set always_yes yes --set changeps1 no
  - conda update -q conda

  - conda env create -q --force -f .travis/environment.yml
  - source activate datacube-qgis
  - export PYTHONPATH=$CONDA_PREFIX/share/qgis/python/plugins/processing:$CONDA_PREFIX/share/qgis/python:$PYTHONPATH
  # Useful for debugging any issues with conda
  - conda info -a

  # Check disk usage
  # - df -h
  # - df -i

script:
- make test

before_deploy:
- make

deploy:
  provider: releases
  api_key:
    secure: AkdnqHzJJ3XhVyJHeGjp945bUEo3InEyYPu0zs+Yv4Nvs/SPArwW01ZZ8arfGnBmRAZdd/X0b2PydZJkqcIQzGeRGCFL5rvi4r6FSzq49Q6SU4vvBAVvSQmCfWHKzDC6Z/0kLYtuHhK2dKssJHeDqXQid2XwixCQntmccZqNmRhGf7BoV8+1+DrviIA75isMjzl82MxhozH8UF7m/+IAfjephLQ5Q+k+0jyb7sMkGHMQIzOIyRdAI3LTwmNbkFfzidbKEoSQvVzaxQUcLbjxEzK6rJZotukhK1uw4Dd8MZ03BC+DWDPb9UmgZJZ9KdtP8dJCg4ROGVTJllcSOe7IrSxo8Db+l1tAU/KgbFq52rL91FRnKYoVC7BmPffpmKND3426u5Gu5EhGKMtLvE+yatQ9f4NGeVfIW1X5tTvtu9yZKQ8aG5+6r5WTg8GQGODzQa947CNrUL0OzAzpsUKgofGyIcnPKr/XP8LPe9puQ/qt8X9HC+LeP4KcspSqUavELmnDxl+nf8F1hp2dqKL0qatWYPDeuqxT2AeX4CyVz6PzKSAje9VcYKlI7Y8oORYMYNJHYPwjK6Ig7GqpyMIiSV5QmQ0glL9jlsouTFTTV8OyWq8B2j9EwKt8pnXSEk7CYeMVPEGFZjxt5lbTCX8epvVBey1kT+oO8FwpZqu2r+g=
  file: dist/datacube_query.zip
  skip_cleanup: true
  on:
    repo: lpinner/datacube-qgis
    tags: true
